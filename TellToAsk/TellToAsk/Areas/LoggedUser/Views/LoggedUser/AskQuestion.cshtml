@model TellToAsk.Model.Question

@using (Html.BeginForm("CreateQuestion", "LoggedUser"))
{
    
    <fieldset>
        <legend>Ask question</legend>
       <input class="btn btn-info" type="button" id="target-group-button" value="Target Group"/>
        @Ajax.ActionLink("Target group", "RenderTargetGroupForm"
                 , null, new AjaxOptions
                 {
                     HttpMethod = "GET",
                     InsertionMode = InsertionMode.Replace,
                     UpdateTargetId = "target-question-form",
                     LoadingElementId = "loading",
                     OnSuccess = "hideButton",
                     OnFailure = "alertMessage"
                 }, new { id = "ajax-button" })

        <div class="control-group">
            @Html.LabelFor(model => model.Text, new { @class = "control-label" })
            <div class="controls">
                @Html.EditorFor(model => model.Text)
                @Html.ValidationMessageFor(model => model.Text, null, new { @class = "help-inline" })
            </div>
        </div>
        <div class="control-group">
            @Html.LabelFor(model => model.CategoryId, new { @class = "control-label" })
            <div class="controls">
                @Html.DropDownListFor(model => model.CategoryId, (IEnumerable<SelectListItem>)ViewBag.Categories)
                @Html.ValidationMessageFor(model => model.CategoryId, null, new { @class = "help-inline" })
            </div>
        </div>
        
        <div id="target-question-form">
            
        </div>
        <input type="submit" class="btn btn-success" value="Answer" />
    </fieldset>
}
 
<script>
        function hideButton(data) {
            console.log(data);
            $("#ajax-button").hide();
            $('#target-question-form').html(data);
        }

        function alertMessage() {
            alert("Something is terribly wrong!")
        }

        $('#target-group-button').click(function (e) {
            e.preventDefault;
            debugger;
            var isHidden = $('#target-question-form').hasClass("hidden");
            if (!isHidden) {
                debugger;

                $.getJSON("RenderTargetGroupForm", null, function (data) {
                    console.log(data);
                    $('#target-question-form').html(data);
                });

                $(this).val("Target Group");
                $('#target-question-form').addClass("hidden");
            }
            else {
                debugger;
                $(this).val("Hide");
                $('#target-question-form').removeClass("hidden");
            }
        });
   
</script>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
}


